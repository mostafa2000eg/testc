@echo off
chcp 65001 > nul
title إنشاء الحزمة المحمولة - نظام إدارة مشاكل العملاء

echo.
echo ================================
echo إنشاء الحزمة المحمولة
echo نظام إدارة مشاكل العملاء
echo ================================
echo.

echo 🔍 فحص Python...
python --version > nul 2>&1
if %errorlevel% neq 0 (
    python3 --version > nul 2>&1
    if %errorlevel% neq 0 (
        echo ❌ Python غير مثبت أو غير موجود في PATH
        echo يرجى تثبيت Python من: https://www.python.org/downloads/
        pause
        exit /b 1
    ) else (
        set PYTHON_CMD=python3
    )
) else (
    set PYTHON_CMD=python
)

%PYTHON_CMD% --version
echo ✅ Python متوفر
echo.

echo 🔧 فحص pip...
%PYTHON_CMD% -m pip --version > nul 2>&1
if %errorlevel% neq 0 (
    echo ❌ pip غير متوفر
    pause
    exit /b 1
)

echo ✅ pip متوفر
echo.

echo 📦 تثبيت PyInstaller...
%PYTHON_CMD% -m pip install pyinstaller
if %errorlevel% neq 0 (
    echo ⚠️ فشل في تثبيت PyInstaller، جاري المحاولة بدونه...
    goto :manual_package
)

echo ✅ تم تثبيت PyInstaller
echo.

echo 🔨 تجميع البرنامج...
%PYTHON_CMD% -m PyInstaller --onefile --windowed --name "نظام_إدارة_مشاكل_العملاء" enhanced_main.py

if %errorlevel% neq 0 (
    echo ❌ فشل في تجميع البرنامج
    goto :manual_package
)

echo ✅ تم تجميع البرنامج بنجاح
echo.

echo 📁 إنشاء الحزمة المحمولة...
if exist "نظام_إدارة_مشاكل_العملاء_المحمول" (
    rmdir /s /q "نظام_إدارة_مشاكل_العملاء_المحمول"
)

mkdir "نظام_إدارة_مشاكل_العملاء_المحمول"

if exist "dist\نظام_إدارة_مشاكل_العملاء.exe" (
    copy "dist\نظام_إدارة_مشاكل_العملاء.exe" "نظام_إدارة_مشاكل_العملاء_المحمول\"
    echo ✅ تم نسخ الملف المجمع
) else (
    echo ❌ لم يتم العثور على الملف المجمع
    goto :manual_package
)

goto :copy_files

:manual_package
echo.
echo 📦 إنشاء حزمة يدوية...
if exist "نظام_إدارة_مشاكل_العملاء_المحمول" (
    rmdir /s /q "نظام_إدارة_مشاكل_العملاء_المحمول"
)

mkdir "نظام_إدارة_مشاكل_العملاء_المحمول"

echo ✅ تم إنشاء مجلد الحزمة
echo.

echo 📋 نسخ ملفات Python...
copy "enhanced_main.py" "نظام_إدارة_مشاكل_العملاء_المحمول\"
copy "enhanced_database.py" "نظام_إدارة_مشاكل_العملاء_المحمول\"
copy "enhanced_main_window.py" "نظام_إدارة_مشاكل_العملاء_المحمول\"
copy "enhanced_functions.py" "نظام_إدارة_مشاكل_العملاء_المحمول\"
copy "enhanced_file_manager.py" "نظام_إدارة_مشاكل_العملاء_المحمول\"
copy "test_enhanced_system.py" "نظام_إدارة_مشاكل_العملاء_المحمول\"

echo ✅ تم نسخ ملفات Python

:copy_files
echo.
echo 📄 نسخ الملفات المساعدة...
copy "دليل_النظام_المحسن.md" "نظام_إدارة_مشاكل_العملاء_المحمول\" 2>nul
copy "ملخص_النظام_المحسن.md" "نظام_إدارة_مشاكل_العملاء_المحمول\" 2>nul
copy "README_Enhanced.md" "نظام_إدارة_مشاكل_العملاء_المحمول\" 2>nul
copy "enhanced_requirements.txt" "نظام_إدارة_مشاكل_العملاء_المحمول\" 2>nul

echo ✅ تم نسخ الملفات المساعدة
echo.

echo 🛠️ إنشاء ملفات التشغيل...

rem إنشاء ملف تشغيل للنسخة المجمعة
if exist "نظام_إدارة_مشاكل_العملاء_المحمول\نظام_إدارة_مشاكل_العملاء.exe" (
    echo @echo off > "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo chcp 65001 ^> nul >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo title نظام إدارة مشاكل العملاء >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo echo. >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo echo 🚀 تشغيل النظام... >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo start "" "نظام_إدارة_مشاكل_العملاء.exe" >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo echo ✅ تم تشغيل النظام >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo pause ^> nul >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
) else (
    rem إنشاء ملف تشغيل للنسخة Python
    echo @echo off > "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo chcp 65001 ^> nul >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo title نظام إدارة مشاكل العملاء >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo echo. >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo     echo 🚀 تشغيل النظام... >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo %PYTHON_CMD% enhanced_main.py >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo if %%errorlevel%% neq 0 ^( >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo     echo ❌ خطأ في تشغيل النظام >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo     echo تأكد من تثبيت Python >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo     pause >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
    echo ^) >> "نظام_إدارة_مشاكل_العملاء_المحمول\تشغيل_النظام.bat"
)

rem إنشاء ملف اختبار
echo @echo off > "نظام_إدارة_مشاكل_العملاء_المحمول\اختبار_النظام.bat"
echo chcp 65001 ^> nul >> "نظام_إدارة_مشاكل_العملاء_المحمول\اختبار_النظام.bat"
echo title اختبار نظام إدارة مشاكل العملاء >> "نظام_إدارة_مشاكل_العملاء_المحمول\اختبار_النظام.bat"
echo echo. >> "نظام_إدارة_مشاكل_العملاء_المحمول\اختبار_النظام.bat"
echo echo 🧪 اختبار النظام... >> "نظام_إدارة_مشاكل_العملاء_المحمول\اختبار_النظام.bat"
echo %PYTHON_CMD% test_enhanced_system.py >> "نظام_إدارة_مشاكل_العملاء_المحمول\اختبار_النظام.bat"
echo pause >> "نظام_إدارة_مشاكل_العملاء_المحمول\اختبار_النظام.bat"

echo ✅ تم إنشاء ملفات التشغيل
echo.

echo 📝 إنشاء ملف المعلومات...
echo # نظام إدارة مشاكل العملاء - الحزمة المحمولة > "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
echo. >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
echo ## كيفية التشغيل: >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"

if exist "نظام_إدارة_مشاكل_العملاء_المحمول\نظام_إدارة_مشاكل_العملاء.exe" (
    echo 1. انقر نقراً مزدوجاً على "تشغيل_النظام.bat" >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
    echo 2. أو انقر نقراً مزدوجاً على "نظام_إدارة_مشاكل_العملاء.exe" >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
) else (
    echo 1. انقر نقراً مزدوجاً على "تشغيل_النظام.bat" >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
    echo 2. تأكد من تثبيت Python على الجهاز >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
)

echo. >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
echo ## للاختبار: >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
echo - انقر على "اختبار_النظام.bat" >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
echo. >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
echo ## المطور: >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"
echo مساعد الذكي الاصطناعي - 2024 >> "نظام_إدارة_مشاكل_العملاء_المحمول\معلومات_التشغيل.txt"

echo ✅ تم إنشاء ملف المعلومات
echo.

echo 🧹 تنظيف الملفات المؤقتة...
if exist "build" rmdir /s /q "build" 2>nul
if exist "dist" rmdir /s /q "dist" 2>nul
if exist "__pycache__" rmdir /s /q "__pycache__" 2>nul
if exist "*.spec" del "*.spec" 2>nul

echo ✅ تم التنظيف
echo.

echo 🎉 تم إنجاز الحزمة المحمولة بنجاح!
echo.
echo 📦 الحزمة جاهزة في: نظام_إدارة_مشاكل_العملاء_المحمول
echo.
echo 💡 يمكنك نسخ هذا المجلد لأي جهاز وتشغيله
echo.

if exist "نظام_إدارة_مشاكل_العملاء_المحمول\نظام_إدارة_مشاكل_العملاء.exe" (
    echo ✅ الحزمة تحتوي على ملف .exe - لا تحتاج Python
) else (
    echo ⚠️ الحزمة تحتاج Python مثبت على الجهاز الهدف
)

echo.
echo 👋 اضغط أي مفتاح للخروج...
pause > nul